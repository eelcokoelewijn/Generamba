import Foundation

{% if custom_parameters.hasDelegate == "yes" and custom_parameters.delegate != "" %}
protocol {{ module_info.name }}PresenterDelegate: class {
    func dismiss(presenter: {{ module_info.name }}Presenter)
}
{% endif %}

protocol {{ module_info.name }}Output: class {
    func setLabel(text: String)
}

protocol {{ module_info.name }}Presenter {
    func start()
    func setOutput(_ output: {{ module_info.name }}Output)
    {% if custom_parameters.hasDelegate == "yes" and custom_parameters.delegate != "" %}
    func dismiss()
    {% endif %}
}

protocol Uses{{ module_info.name }}Presenter {
    var {{ module_info.name | downcase }}Presenter: {{ module_info.name }}Presenter { get }
}

class Mixin{{ module_info.name }}Presenter: {{ module_info.name }}Presenter {
    weak var output: {{ module_info.name }}Output?
    {% if custom_parameters.hasDelegate == "yes" and custom_parameters.delegate != "" %}
    weak var delegate: {{ module_info.name }}PresenterDelegate?
    {% endif %}
    func start() {
        output?.setLabel(text: "{{ module_info.name }} view")
    }

    func setOutput(_ output: {{ module_info.name }}Output) {
        self.output = output
    }

    {% if custom_parameters.hasDelegate == "yes" and custom_parameters.delegate != "" %}
    func dismiss() {
        delegate?.dismiss(presenter: self)
    }
    {% endif %}
}

{% if custom_parameters.hasDelegate == "yes" and custom_parameters.delegate != "" %}
// Move to {{ custom_parameters.delegate }}
extension {{ custom_parameters.delegate }}: {{ module_info.name }}PresenterDelegate {
    func dismiss(presenter: {{ module_info.name }}Presenter) {

    }

    func create{{ module_info.name }}ViewController() -> {{ module_info.name }}ViewController {
        let presenter: Mixin{{ module_info.name }}Presenter = Mixin{{ module_info.name }}Presenter()
        presenter.delegate = self
        let viewController: {{ module_info.name }}ViewController = {{ module_info.name }}ViewController(presenter: presenter)
        return viewController
    }
}
{% endif %}
